Running all tests...
ts-jest[ts-jest-transformer] (WARN) Define `ts-jest` config under `globals` is deprecated. Please do
transform: {
    <transform_regex>: ['ts-jest', { /* ts-jest config goes here in Jest */ }],
},
ts-jest[ts-jest-transformer] (WARN) Define `ts-jest` config under `globals` is deprecated. Please do
transform: {
    <transform_regex>: ['ts-jest', { /* ts-jest config goes here in Jest */ }],
},
ts-jest[ts-jest-transformer] (WARN) Define `ts-jest` config under `globals` is deprecated. Please do
transform: {
    <transform_regex>: ['ts-jest', { /* ts-jest config goes here in Jest */ }],
},
ts-jest[ts-jest-transformer] (WARN) Define `ts-jest` config under `globals` is deprecated. Please do
transform: {
    <transform_regex>: ['ts-jest', { /* ts-jest config goes here in Jest */ }],
},
ts-jest[ts-jest-transformer] (WARN) Define `ts-jest` config under `globals` is deprecated. Please do
transform: {
    <transform_regex>: ['ts-jest', { /* ts-jest config goes here in Jest */ }],
},
ts-jest[ts-jest-transformer] (WARN) Got a `.js` file to compile while `allowJs` option is not set to `true` (file: /app/.jest/setEnvVars.js). To fix this:
  - if you want TypeScript to process JS files, set `allowJs` to `true` in your TypeScript config (usually tsconfig.json)
  - if you do not want TypeScript to process your `.js` files, in your Jest config change the `transform` key which value is `ts-jest` so that it does not match `.js` files anymore
FAIL examples/jest-integration/index.test.ts
  Ã¢â€”Â Test suite failed to run

    [96mexamples/jest-integration/index.test.ts[0m:[93m3[0m:[93m36[0m - [91merror[0m[90m TS2307: [0mCannot find module '../../dist/types.js' or its corresponding type declarations.

    [7m3[0m import type { GradingConfig } from '../../dist/types.js';
    [7m [0m [91m                                   ~~~~~~~~~~~~~~~~~~~~~[0m

Creating cache folder at /root/.promptfoo/cache.
Cache is disabled.
PASS test/providers.test.ts
  providers
    Ã¢Å“â€œ OpenAiCompletionProvider callApi (10 ms)
    Ã¢Å“â€œ OpenAiChatCompletionProvider callApi (3 ms)
    Ã¢Å“â€œ OpenAiChatCompletionProvider callApi with cache disabled (2 ms)
    Ã¢Å“â€œ loadApiProvider with openai:chat (1 ms)
    Ã¢Å“â€œ loadApiProvider with openai:completion
    Ã¢Å“â€œ loadApiProvider with openai:chat:modelName (1 ms)
    Ã¢Å“â€œ loadApiProvider with openai:completion:modelName

Cache is disabled.
Cache is disabled.
PASS test/cache.test.ts
  fetchJsonWithCache
    Ã¢Å“â€œ should not cache data with failed request (7 ms)
    Ã¢Å“â€œ should fetch data with cache enabled (5 ms)
    Ã¢Å“â€œ should fetch data with cache enabled after previous test (1 ms)
    Ã¢Å“â€œ should fetch data without cache for a single test (2 ms)
    Ã¢Å“â€œ should still fetch data without cache for a single test (2 ms)

PASS test/util.test.ts
  util
    Ã¢Å“â€œ readPrompts with single prompt file (5 ms)
    Ã¢Å“â€œ readPrompts with multiple prompt files (1 ms)
    Ã¢Å“â€œ readPrompts with directory (1 ms)
    Ã¢Å“â€œ readPrompts with empty input (1 ms)
    Ã¢Å“â€œ readPrompts with map input (1 ms)
    Ã¢Å“â€œ readVars with CSV input (6 ms)
    Ã¢Å“â€œ readVars with JSON input (1 ms)
    Ã¢Å“â€œ readVars with YAML input (18 ms)
    Ã¢Å“â€œ writeOutput with CSV output (4 ms)
    Ã¢Å“â€œ writeOutput with JSON output (1 ms)
    Ã¢Å“â€œ writeOutput with YAML output (6 ms)
  readTests
    Ã¢Å“â€œ readTests with no input (1 ms)
    Ã¢Å“â€œ readTests with string input (CSV file path) (4 ms)
    Ã¢Å“â€œ readTests with array input (TestCase[])

PASS test/assertions.test.ts
  runAssertions
    Ã¢Å“â€œ should pass when all assertions pass (4 ms)
    Ã¢Å“â€œ should fail when any assertion fails (1 ms)
  runAssertion
    Ã¢Å“â€œ should pass when the equality assertion passes (1 ms)
    Ã¢Å“â€œ should fail when the equality assertion fails
    Ã¢Å“â€œ should pass when the is-json assertion passes
    Ã¢Å“â€œ should fail when the is-json assertion fails (1 ms)
    Ã¢Å“â€œ should pass when the contains-json assertion passes
    Ã¢Å“â€œ should fail when the contains-json assertion fails
    Ã¢Å“â€œ should pass when the function assertion passes (8 ms)
    Ã¢Å“â€œ should fail when the function assertion fails (1 ms)
    Ã¢Å“â€œ should pass when the function assertion passes - with vars (1 ms)
    Ã¢Å“â€œ should fail when the function does not match vars (1 ms)
    Ã¢Å“â€œ should pass when the not-contains assertion passes
    Ã¢Å“â€œ should fail when the not-contains assertion fails (1 ms)
    Ã¢Å“â€œ should pass when the icontains assertion passes
    Ã¢Å“â€œ should fail when the icontains assertion fails (1 ms)
    Ã¢Å“â€œ should pass when the not-icontains assertion passes (1 ms)
    Ã¢Å“â€œ should fail when the not-icontains assertion fails
    Ã¢Å“â€œ should pass when the contains-any assertion passes (1 ms)
    Ã¢Å“â€œ should fail when the contains-any assertion fails
    Ã¢Å“â€œ should pass when the contains-all assertion passes (1 ms)
    Ã¢Å“â€œ should fail when the contains-all assertion fails
    Ã¢Å“â€œ should pass when the regex assertion passes (1 ms)
    Ã¢Å“â€œ should fail when the regex assertion fails
    Ã¢Å“â€œ should pass when the not-regex assertion passes
    Ã¢Å“â€œ should fail when the not-regex assertion fails
  assertionFromString
    Ã¢Å“â€œ should create an equality assertion (1 ms)
    Ã¢Å“â€œ should create an is-json assertion
    Ã¢Å“â€œ should create an contains-json assertion (1 ms)
    Ã¢Å“â€œ should create a function assertion
    Ã¢Å“â€œ should create a similarity assertion (1 ms)
    Ã¢Å“â€œ should create a contains assertion
    Ã¢Å“â€œ should create a not-contains assertion (1 ms)
    Ã¢Å“â€œ should create a contains-any assertion (2 ms)
    Ã¢Å“â€œ should create a contains-all assertion (1 ms)
    Ã¢Å“â€œ should create a regex assertion (1 ms)
    Ã¢Å“â€œ should create a not-regex assertion
    Ã¢Å“â€œ should create an icontains assertion
    Ã¢Å“â€œ should create a not-icontains assertion (1 ms)
  matchesSimilarity
    Ã¢Å“â€œ should pass when similarity is above the threshold (3 ms)
    Ã¢Å“â€œ should fail when similarity is below the threshold
    Ã¢Å“â€œ should fail when inverted similarity is above the threshold
    Ã¢Å“â€œ should pass when inverted similarity is below the threshold (1 ms)
  matchesLlmRubric
    Ã¢Å“â€œ should pass when the grading provider returns a passing result (5 ms)
    Ã¢Å“â€œ should fail when the grading provider returns a failing result (1 ms)

Test Suites: 1 failed, 4 passed, 5 total
Tests:       71 passed, 71 total
Snapshots:   0 total
Time:        5.329 s
